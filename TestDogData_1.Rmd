---
title: "Eval Landsharc sims"
author: "Katie Lotterhos"
date: "May 24, 2016"
output: html_document
---
### Load packages and data
```{r setup, include=FALSE}
setwd("/Users/katie/Desktop/MINOTAUReval")
source("evalsims/ComparePlot2.R")
source("evalsims/distanceFunctionsOther.R")
source("evalsims/getEmpiricalP2.R")
source("evalsims/Getdf.R")


if(!("devtools" %in% installed.packages())){install.packages("devtools", dependencies=TRUE)}
if(!("rrcovNA" %in% installed.packages())){install.packages("rrcovNA")}
if(!("qvalue" %in% installed.packages())){
  source("https://bioconductor.org/biocLite.R")
  biocLite("qvalue")
  }

library(qvalue)
library(rrcovNA)
library(devtools)
install_github("NESCent/MINOTAUR")#, build_vignettes=TRUE)
library(MINOTAUR)

headdir <- "~/Desktop/MINOTAUReval/data/dog_full/"
outdir <- "~/Desktop/MINOTAUReval/data/dog_full_multvar_iHS_nSL_pi_TD_H12/"
#resultsdir <- "~/Desktop/MINOTAUReval/results/"
filelist <- list.files(headdir)
length(filelist)
if (!length(filelist)==25){print("Errr: missing simulation files")}

sessionInfo()
```

### Loop through each dataset
The following chunk of code does for each dataset:
1) calculate multivariate distances based on default covariance matrix
2) compares covariance matrix estimated from just neutral loci to covariance matrix on all data and MCD estimate of covariance
3) calculate multivariate distances based on MCD covariance matrix


```{r}
for (i in 1:length(filelist)){
  print(c(i, filelist[i]))
  infile <- paste(headdir, filelist[i], sep="")
  dat <- read.csv(infile, header=TRUE)
  cols <- which(names(dat) %in% c("unstd_iHS", 
                                  "unstd_nSL",
                                  "win51_pi",
                                  "win51_TajD",
                                  "win51_H12"))
    # don't include H: makes cov matrix singular
  cols
  dat2 <- dat
  
  ### Get stats based on covmat of all the data
  dat.out.defaultS <- Getdf(dat2, cols)
  head(dat.out.defaultS)
  colnames(dat.out.defaultS)[(ncol(dat.out.defaultS)-5):
                               ncol(dat.out.defaultS)] <-
    c("pcs.default","Hcd.default", "Md.default", 
      "Hd.default", "Kd.default", "Nd.default")
  #head(dat.out.defaultS)
  #dim(dat.out)

    # Covariance of all loci
    Sall <- cov(dat2[complete.cases(dat2),cols])
    
    # Covariance of MCD
    S_mcd <- CovNAMcd(dat2[,cols])
    S_mcd
    
    par(mar=c(4,4,1,1))
    plot(S_mcd@cov, Sall)
    abline(0,1)
    
    ### Get stats based on mcd covmat
    dat.out <- Getdf(dat.out.defaultS,cols,S=S_mcd@cov)
    (dat.out[100:120,])
    colnames(dat.out)[(ncol(dat.out)-3):
                               ncol(dat.out)] <-
    c( "Md.mcd", "Hd.mcd", "Kd.mcd", "Nd.mcd") 
     head(dat.out)

  write.csv(dat.out, file = paste(outdir,"set1_", filelist[i], sep=""))
}


```
